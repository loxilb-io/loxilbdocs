
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://loxilb-io.github.io/loxilbdocs/k8s_bgp_policy_crd/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>License - LoxiLB</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#license" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://www.loxilb.io/" title="LoxiLB" class="md-header__button md-logo" aria-label="LoxiLB" data-md-component="logo">
      
  <img src="../photos/loxilb-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LoxiLB
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              License
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/loxilb-io/loxilb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    loxilb-io/loxilb
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://www.loxilb.io/" title="LoxiLB" class="md-nav__button md-logo" aria-label="LoxiLB" data-md-component="logo">
      
  <img src="../photos/loxilb-logo.png" alt="logo">

    </a>
    LoxiLB
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/loxilb-io/loxilb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    loxilb-io/loxilb
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LoxiLB
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architectural Considerations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Architectural Considerations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kube-loxilb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding loxilb deployment in K8s with kube-loxilb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ha-deploy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding High-availability with loxilb
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    External Cluster Mode
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            External Cluster Mode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k3s_quick_start_flannel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K3s/loxilb with default flannel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k3s_quick_start_calico/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K3s/loxilb with calico
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quick_start_with_cilium/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K3s/loxilb with cilium
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k0s_quick_start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K0s/loxilb with kube-router
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    In-Cluster Mode
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            In-Cluster Mode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k3s_quick_start_incluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K3s/loxilb in-cluster mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k0s_quick_start_incluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K0s/loxilb in-cluster mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../microk8s_quick_start_incluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MicroK8s/loxilb in-cluster mode
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Service-Proxy Mode
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Service-Proxy Mode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../service-proxy-flannel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K3s/loxilb service-proxy with flannel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../service-proxy-calico/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K3s/loxilb service-proxy with calico
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes Ingress Mode
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes Ingress Mode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../loxilb-ingress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k3s/Run loxilb-ingress
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../standalone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standalone Mode
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Advanced Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../service-zones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How-To - service-group zones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ext-ep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How-To - access end-points outside K8s
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k3s-multi-master/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How-To - Deploy multi-server K3s HA with loxilb
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Knowledge Base
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Knowledge Base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ebpf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is eBPF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is k8s service - load-balancer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture in brief
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code organization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../loxilbebpf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eBPF internals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NAT Modes of loxilb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lb-algo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    loxilb load-balancer algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manual steps to build/run
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging loxilb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cmd-dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer's guide to loxicmd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer's guide to loxilb API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    loxilb api-reference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../perf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance Report
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribution Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frequenctly Asked Questions- FAQs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blogs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Blogs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.loxilb.io/post/loxilb-cluster-networking-elevating-k8s-networking-capabilities" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8s - Elevating Cluster Networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.loxilb.io/post/state-synchronization-of-ebpf-maps-using-go-a-tale-of-two-frameworks" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eBPF - Map Sync using Go
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.loxilb.io/post/k8s-nuances-of-in-cluster-external-service-lb-with-loxilb" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8s in-cluster service LB with LoxiLB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.loxilb.io/post/k8s-introducing-sctp-multihoming-functionality-with-loxilb" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8s - Introducing SCTP Multihoming with LoxiLB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.loxilb.io/post/loxilb-anycast-service-load-balancing-with-high-availability" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hyperscale anycast load balancing with HA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.loxilb.io/post/loxilb-load-balancer-setup-on-eks" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started with loxilb on Amazon EKS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.loxilb.io/post/k8s-deploying-hitless-and-ha-load-balancing" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8s - Deploying hitless Load-Balancing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.loxilb.io/post/k8s-exposing-ipv4-services-externally-as-ipv6" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ipv6 migration in Kubernetes made easy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.loxilb.io/post/running-loxilb-on-aws-graviton2-based-ec2-instance" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load-balancer Perf comparison on Amazon Graviton2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_10" >
        
          
          <label class="md-nav__link" for="__nav_6_10" id="__nav_6_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Community Posts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_10">
            <span class="md-nav__icon md-icon"></span>
            Community Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://futuredon.medium.com/5g-sctp-loadbalancer-using-loxilb-b525198a9103" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5G SCTP LoadBalancer Using loxilb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://futuredon.medium.com/5g-uplink-classifier-using-loxilb-7593a4d66f4c" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5G Uplink Classifier Using loxilb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://cloudybytes.medium.com/k3s-using-loxilb-as-external-service-lb-2ea4ce61e159" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K3s - Using loxilb as external service lb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://medium.com/@ben0978327139/5g-sctp-loadbalancer-using-loxilb-applying-on-free5gc-b5c05bb723f0" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5G SCTP LoadBalancer Using LoxiLB Applying on free5GC
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="license">License</h1>
<p>This document is based on the original work by <a href="https://github.com/osrg/gobgp.git">GOBGP</a>.
Changes have been made to the original document.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<div class="highlight"><pre><span></span><code>http://www.apache.org/licenses/LICENSE-2.0
</code></pre></div>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
<h1 id="policy-configuration">Policy Configuration</h1>
<p>This page explains LoxiLB with GoBGP policy feature for controlling the route
advertisement. It might be called Route Map in other BGP
implementations.</p>
<p>And This document was written with reference to <a href="https://github.com/osrg/gobgp/blob/master/docs/sources/policy.md">this goBGP official document.</a></p>
<p>We explain the overview firstly, then the details.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Assumed that you run loxilb with <code>-b</code> option. Or If you control loxilb through kube-loxilb, be sure to set the <code>--set-bgp</code> option in the kube-loxilb.yaml file.</p>
<p><div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>--cap-add<span class="w"> </span>SYS_ADMIN<span class="w"> </span>--restart<span class="w"> </span>unless-stopped<span class="w"> </span>--privileged<span class="w"> </span>-dit<span class="w"> </span>-v<span class="w"> </span>/dev/log:/dev/log<span class="w"> </span>--name<span class="w"> </span>loxilb<span class="w"> </span>ghcr.io/loxilb-io/loxilb:latest<span class="w"> </span>-b
</code></pre></div>
or in the kube-loxilb.yaml
And adding  <code>- --enableBGPCRDs</code> option in kube-loxilb.yaml
<div class="highlight"><pre><span></span><code>        args:
            - --loxiURL=http://12.12.12.1:11111
            - --externalCIDR=123.123.123.1/24
            - --setBGP=65100
            - --enableBGPCRDs
</code></pre></div></p>
<p>And apply CRD yamls as first step.</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f manifest/crds/bgp-policy-apply-service.yaml
kubectl apply -f manifest/crds/bgp-policy-defined-sets-service.yaml
kubectl apply -f manifest/crds/bgp-policy-definition-service.yaml
</code></pre></div>
<p>(Note) Currently, gobgp does not support the Policy command in global state. Therefore, only the policy for neighbors is applied, and we plan to apply the global policy through additional development.
To apply a policy in a neighbor, you must form a peer by adding the <code>route-server-client</code> option when using gobgp in loxilb. This does not provide a separate API and will be provided in the future.
For examples in gobgp, please refer to the following <a href="https://github.com/osrg/gobgp/blob/master/docs/sources/route-server.md">documents</a>.</p>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#policy-configuration">Policy Configuration</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#contents">Contents</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#route-server-policy-model">Route Server Policy Model</a></li>
<li><a href="#policy-structure">Policy Structure</a></li>
<li><a href="#configure-policies">Configure Policies</a><ul>
<li><a href="#1-defining-defined-sets">1. Defining defined-sets</a></li>
<li><a href="#prefix-sets">prefix-sets</a><ul>
<li><a href="#examples">Examples</a></li>
</ul>
</li>
<li><a href="#neighbor-sets">neighbor-sets</a><ul>
<li><a href="#examples-1">Examples</a></li>
</ul>
</li>
<li><a href="#2-defining-bgp-defined-sets">2. Defining bgp-defined-sets</a></li>
<li><a href="#community-sets">community-sets</a><ul>
<li><a href="#examples-2">Examples</a></li>
</ul>
</li>
<li><a href="#ext-community-sets">ext-community-sets</a><ul>
<li><a href="#examples-3">Examples</a></li>
</ul>
</li>
<li><a href="#as-path-sets">as-path-sets</a><ul>
<li><a href="#examples-4">Examples</a></li>
</ul>
</li>
<li><a href="#3-defining-policy-definitions">3. Defining policy-definitions</a></li>
<li><a href="#execution-condition-of-action">Execution condition of Action</a><ul>
<li><a href="#examples-5">Examples</a></li>
</ul>
</li>
<li><a href="#4-attaching-policy">4. Attaching policy</a></li>
<li><a href="#41-attach-policy-to-route-server-client">4.1. Attach policy to route-server-client</a></li>
</ul>
</li>
<li><a href="#policy-and-soft-reset">Policy and Soft Reset</a></li>
</ul>
<h2 id="overview">Overview</h2>
<p>Policy is a way to control how BGP routes inserted to RIB or advertised to
peers. Policy has two parts, <strong>Condition</strong> and <strong>Action</strong>.
When a policy is configured, <strong>Action</strong> is applied to routes which meet
<strong>Condition</strong> before routes proceed to next step.</p>
<p>GoBGP supports <strong>Condition</strong> like <code>prefix</code>, <code>neighbor</code>(source/destination of
the route), <code>aspath</code> etc.., and <strong>Action</strong> like <code>accept</code>, <code>reject</code>,
<code>MED/aspath/community manipulation</code> etc...</p>
<p>You can configure policy by configuration file, CLI or gRPC API.
Here, we show how to configure policy via configuration file.</p>
<h2 id="route-server-policy-model">Route Server Policy Model</h2>
<p>The following figure shows how policy works in
<a href="route-server.md">route server BGP configuration</a>.</p>
<p><img alt="route server policy model" src="../photos/policy.png" /></p>
<p>In route server mode, <strong>Import</strong> and <strong>Export</strong> policies are defined
with respect to a peer.  The <strong>Import</strong> policy defines what routes
will be imported into the master RIB. The <strong>Export</strong> policy defines
what routes will be exported from the master RIB.</p>
<p>You can check each policy by the following commands in the loxilb.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gobgp<span class="w"> </span>neighbor<span class="w"> </span>&lt;neighbor-addr&gt;<span class="w"> </span>policy<span class="w"> </span>import
$<span class="w"> </span>gobgp<span class="w"> </span>neighbor<span class="w"> </span>&lt;neighbor-addr&gt;<span class="w"> </span>policy<span class="w"> </span><span class="nb">export</span>
</code></pre></div>
<h2 id="policy-structure">Policy Structure</h2>
<p><img alt="policy component" src="../photos/policy-component.png" /></p>
<p>A policy consists of statements. Each statement has condition(s) and action(s).</p>
<p>Conditions are categorized into attributes below:</p>
<ul>
<li>prefix</li>
<li>neighbor</li>
<li>aspath</li>
<li>aspath length</li>
<li>community</li>
<li>extended community</li>
<li>rpki validation result</li>
<li>route type (internal/external/local)</li>
<li>large community</li>
<li>afi-safi in</li>
</ul>
<p>As showed in the figure above, some of the conditions point to defined sets,
which are a container for each condition item (e.g. prefixes).</p>
<p>Actions are categorized into attributes below:</p>
<ul>
<li>accept or reject</li>
<li>add/replace/remove community or remove all communities</li>
<li>add/subtract or replace MED value</li>
<li>set next-hop (specific address/own local address/don't modify)</li>
<li>set local-pref</li>
<li>prepend AS number in the AS_PATH attribute</li>
</ul>
<p>When <strong>ALL</strong> conditions in the statement are <code>true</code>, the action(s) in the
statement are executed.</p>
<p>You can check policy configuration by the following commands.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>bgppolicydefinedsetsservice

$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>bgppolicydefinitionservice

$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>bgppolicyapplyservice
</code></pre></div>
<h2 id="configure-policies">Configure Policies</h2>
<p>Policy Configuration comes from two parts, definition and attachment. For definition, we have
<a href="#1-defining-defined-sets">defined-sets</a> and <a href="#3-defining-policy-definitions">policy-definition</a>.
<strong>defined-sets</strong> defines condition item for some of the condition type.
<strong>policy-definitions</strong> defines policies based on actions and conditions.</p>
<ul>
<li>
<p><strong>defined-sets</strong>
  A single <strong>defined-sets</strong> entry has prefix match that is named
  <strong>prefix-sets</strong> and neighbor match part that is named <strong>neighbor-sets</strong>. It
  also has <strong>bgp-defined-sets</strong>, a subset of <strong>defined-sets</strong> that defines
  conditions referring to BGP attributes such as aspath. This <strong>defined-sets</strong>
  has a name and it's used to refer to <strong>defined-sets</strong> items from outside.</p>
</li>
<li>
<p><strong>policy-definitions</strong>
  <strong>policy-definitions</strong> is a list of policy. A single element has
  <strong>statements</strong> part that combines conditions with an action.</p>
</li>
</ul>
<p>Below are the steps for policy configuration</p>
<ol>
<li>define defined-sets<ol>
<li>define prefix-sets</li>
<li>define neighbor-sets</li>
</ol>
</li>
<li>define bgp-defined-sets<ol>
<li>define community-sets</li>
<li>define ext-community-sets</li>
<li>define as-path-setList</li>
<li>define large-community-sets</li>
</ol>
</li>
<li>define policy-definitions</li>
<li>attach neighbor</li>
</ol>
<h3 id="1-defining-defined-sets">1. Defining defined-sets</h3>
<p>defined-sets has prefix information and neighbor information in prefix-sets and
neighbor-sets section, and GoBGP uses these information to evaluate routes.
Defining defined-sets is needed at first.
prefix-sets and neighbor-sets section are prefix match part and neighbor match
part.</p>
<ul>
<li>defined-sets example</li>
</ul>
<p>```yaml
 # prefix match part
apiVersion: bgppolicydefinedsets.loxilb.io/v1
kind: BGPPolicyDefinedSetsService
metadata:
  name: policy-prefix
spec:
  name: "ps1"
  definedType: "prefix"
  prefixList:
    - ipPrefix: "10.33.0.0/16"
      masklengthRange: "21..24"</p>
<h1 id="neighbor-match-part">neighbor match part</h1>
<p>apiVersion: bgppolicydefinedsets.loxilb.io/v1
kind: BGPPolicyDefinedSetsService
metadata:
  name: policy-neighbor
spec:
  name: "ns1"
  definedType: "neighbor"
  List:
  - "10.0.255.1/32"</p>
<p>```</p>
<h4 id="prefix-sets">prefix-sets</h4>
<p>prefix-sets has prefix-set-list, and prefix-set-list has prefix-set-name and
prefix-list as its element. prefix-set-list is used as a condition. Note that
prefix-sets has either v4 or v6 addresses.</p>
<p><strong>prefix</strong> has 1 element and list of sub-elements.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>name of prefix-set</td>
<td>"ps1"</td>
<td></td>
</tr>
<tr>
<td>prefixList</td>
<td>list of prefix and range of length</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>PrefixList</strong> has 2 elements.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>ipPrefix</td>
<td>prefix value</td>
<td>"10.33.0.0/16"</td>
<td></td>
</tr>
<tr>
<td>masklengthRange</td>
<td>range of length</td>
<td>"21..24"</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h5 id="examples">Examples</h5>
<ul>
<li>example 1</li>
<li>Match routes whose high order 2 octets of NLRI is 10.33 and its prefix
    length is between from 21 to 24</li>
<li>If you define a prefix-list that doesn't have MasklengthRange, it matches
    routes that have just 10.33.0.0/16 as NLRI.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 1</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-prefix</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ps1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;prefix&quot;</span>
<span class="w">  </span><span class="nt">prefixList</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipPrefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.33.0.0/16&quot;</span>
<span class="w">      </span><span class="nt">masklengthRange</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;21..24&quot;</span>
</code></pre></div>
<ul>
<li>example 2</li>
<li>If you want to evaluate multiple routes with a single prefix-set-list, you
    can do this by adding an another prefix-list like this:</li>
<li>This prefix-set-list match checks if a route has 10.33.0.0/21 to 24 or
    10.50.0.0/21 to 24.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 2</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-prefix</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ps1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;prefix&quot;</span>
<span class="w">  </span><span class="nt">prefixList</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipPrefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.33.0.0/16&quot;</span>
<span class="w">      </span><span class="nt">masklengthRange</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;21..24&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipPrefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.50.0.0/16&quot;</span>
<span class="w">      </span><span class="nt">masklengthRange</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;21..24&quot;</span>
</code></pre></div>
<ul>
<li>example 3</li>
<li>prefix-set-name under prefix-set-list is reference to a single prefix-set.</li>
<li>If you want to add different prefix-set more, you can add other blocks that
    form the same structure with example 1.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-prefix</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ps1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;prefix&quot;</span>
<span class="w">  </span><span class="nt">prefixList</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipPrefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.33.0.0/16&quot;</span>
<span class="w">      </span><span class="nt">masklengthRange</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;21..24&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-prefix</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ps2&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;prefix&quot;</span>
<span class="w">  </span><span class="nt">prefixList</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipPrefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.50.0.0/16&quot;</span>
<span class="w">      </span><span class="nt">masklengthRange</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;21..24&quot;</span>
</code></pre></div>
<h4 id="neighbor-sets">neighbor-sets</h4>
<p>neighbor-sets has neighbor-set-list, and neighbor-set-list has
neighbor-set-name and neighbor-info-list as its element. It is necessary to
specify a neighbor address in neighbor-info-list. neighbor-set-list is used as
a condition.
<em>Attention: an empty neighbor-set will match against ANYTHING and not invert based on the match option</em></p>
<p><strong>neighbor</strong> has 1 element and list of sub-elements.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>name of neighbor</td>
<td>"ns1"</td>
<td></td>
</tr>
<tr>
<td>List</td>
<td>list of neighbor address</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>neighbor-info-list</strong> has 1 element.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>neighbor address</td>
<td>"10.0.255.1"</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="examples_1">Examples</h5>
<ul>
<li>example 1</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-neighbor</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ns1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;neighbor&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10.0.255.1/32&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-neighbor</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ns2&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;neighbor&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10.0.0.0/24&quot;</span>
</code></pre></div>
<ul>
<li>example 2</li>
<li>As with prefix-set-list, neighbor-set-list can have multiple
    neighbor-info-list like this.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 2</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-neighbor</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ns1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;neighbor&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10.0.255.1/32&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10.0.255.2/32&quot;</span>
<span class="w">  </span><span class="err">```</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example 3</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- As with prefix-set-list, multiple neighbor-set-lists can be defined.</span>

<span class="err">```</span><span class="l l-Scalar l-Scalar-Plain">yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-neighbor</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ns1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;neighbor&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10.0.255.1/32&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-neighbor</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ns2&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;neighbor&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10.0.254.1/32&quot;</span>
</code></pre></div>
<h3 id="2-defining-bgp-defined-sets">2. Defining bgp-defined-sets</h3>
<p>bgp-defined-sets has Community information, Extended Community
information and AS_PATH information in each Sets section
respectively. And it is a child element of defined-sets.
community-sets, ext-community-sets and as-path-sets section are each match
part. Like prefix-sets and neighbor-sets, each can have multiple sets and each
set can have multiple values.</p>
<ul>
<li>bgp-defined-sets example</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Community match part</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-community</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;community1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;community&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;65100:10&quot;</span>

<span class="c1"># Extended Community match part</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-extcommunity</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ecommunity1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;extcommunity&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;RT:65100:100&quot;</span>

<span class="c1"># AS_PATH match part</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-aspath</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;aspath1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;asPath&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;^65100&quot;</span>

<span class="c1"># Large Community match part</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-largecommunity</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;lcommunity1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;largecommunity&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;65100:100:100&quot;</span>
</code></pre></div>
<h4 id="community-sets">community-sets</h4>
<p>community-sets has community-set-name and community-list as its element. The
Community value are used to evaluate communities held by the destination.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>name of CommunitySet</td>
<td>"community1"</td>
<td></td>
</tr>
<tr>
<td>List</td>
<td>list of community value</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>community-list</strong> has 1 element.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>community value</td>
<td>"65100:10"</td>
<td></td>
</tr>
</tbody>
</table>
<p>You can use regular expressions to specify community in community-list.</p>
<h5 id="examples_2">Examples</h5>
<ul>
<li>example 1</li>
<li>Match routes which has "65100:10" as a community value.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 1</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-community</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;community1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;community&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;65100:10&quot;</span>
</code></pre></div>
<ul>
<li>example 2</li>
<li>Specifying community by regular expression</li>
<li>You can use regular expressions based on POSIX 1003.2 regular expressions.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 2</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-community</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;community2&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;community&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;6[0-9]+:[0-9]+&quot;</span>
</code></pre></div>
<h4 id="ext-community-sets">ext-community-sets</h4>
<p>ext-community-sets has ext-community-set-name and ext-community-list as its
element. The values are used to evaluate extended communities held by the
destination.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>name of ExtCommunitySet</td>
<td>"ecommunity1"</td>
<td></td>
</tr>
<tr>
<td>List</td>
<td>list of extended community value</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>List</strong> has 1 element.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>extended community value</td>
<td>"RT:65001:200"</td>
<td></td>
</tr>
</tbody>
</table>
<p>You can use regular expressions to specify extended community in
ext-community-list. However, the first one element separated by (part of "RT")
does not support to the regular expression. The part of "RT" indicates a
subtype of extended community and subtypes that can be used are as follows:</p>
<ul>
<li>RT: mean the route target.</li>
<li>SoO: mean the site of origin(route origin).</li>
<li>encap: mean the encapsulation tunnel type, currently gobgp supports the following encap tunnels:
    l2tp3
    gre
    ip-in-ip
    vxlan
    nvgre
    mpls
    mpls-in-gre
    vxlan-gre
    mpls-in-udp
    sr-policy
    geneve</li>
<li>LB: mean the link-bandwidth (in bytes).</li>
</ul>
<h5 id="examples_3">Examples</h5>
<ul>
<li>example 1</li>
<li>Match routes which has "RT:65001:200" as a extended community value.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 1</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-extcommunity</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ecommunity1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;extcommunity&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;RT:65100:100&quot;</span>
</code></pre></div>
<ul>
<li>example 2</li>
<li>Specifying extended community by regular expression</li>
<li>You can use regular expressions that is available in Golang.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 2</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-extcommunity</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ecommunity2&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;extcommunity&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;RT:6[0-9]+:[0-9]+&quot;</span>
</code></pre></div>
<h4 id="as-path-sets">as-path-sets</h4>
<p>as-path-sets has as-path-set-name and as-path-list as its element. The numbers
are used to evaluate AS numbers in the destination's AS_PATH attribute.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>name of as-path-set</td>
<td>"aspath1"</td>
<td></td>
</tr>
<tr>
<td>List</td>
<td>list of as path value</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>List</strong> has 1 elements.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>as path value</td>
<td>"^65100"</td>
<td></td>
</tr>
</tbody>
</table>
<p>The AS path regular expression is compatible with
<a href="http://www.nongnu.org/quagga/docs/docs-multi/AS-Path-Regular-Expression.html">Quagga</a>
and Cisco. Note Character <code>_</code> has special meaning. It is abbreviation for
<code>(^|[,{}() ]|$)</code>.</p>
<p>Some examples follow:</p>
<ul>
<li>From: <code>^65100_</code> means the route is passed from AS 65100 directly.</li>
<li>Any: <code>_65100_</code> means the route comes through AS 65100.</li>
<li>Origin: <code>_65100$</code> means the route is originated by AS 65100.</li>
<li>Only: <code>^65100$</code> means the route is originated by AS 65100 and comes from it
  directly.</li>
<li><code>^65100_65001</code></li>
<li><code>65100_[0-9]+_.*$</code></li>
<li><code>^6[0-9]_5.*_65.?00$</code></li>
</ul>
<h5 id="examples_4">Examples</h5>
<ul>
<li>example 1</li>
<li>Match routes which come from AS 65100.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 1</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-aspath</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;aspath1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;asPath&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;^65100&quot;</span>
</code></pre></div>
<ul>
<li>example 2</li>
<li>Match routes which come Origin AS 65100 and use regular expressions to
    other AS.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 2</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinedsets.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinedSetsService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-aspath</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;aspath1&quot;</span>
<span class="w">  </span><span class="nt">definedType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;asPath&quot;</span>
<span class="w">  </span><span class="nt">List</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;[0-9]+_65[0-9]+_65100$&quot;</span>
</code></pre></div>
<h3 id="3-defining-policy-definitions">3. Defining policy-definitions</h3>
<p>policy-definitions consists of condition and action. Condition part is used to
evaluate routes from neighbors, if matched, action will be applied.</p>
<ul>
<li>an example of policy-definitions</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinition.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinitionService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-policy</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-policy</span>
<span class="w">  </span><span class="nt">statements</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statement1</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matchPrefixSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prefixSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ps1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">      </span><span class="nt">matchNeighborSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">neighborSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ns1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">invert</span>
<span class="w">      </span><span class="nt">bgpConditions</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchCommunitySet</span><span class="p">:</span>
<span class="w">          </span><span class="nt">communitySet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">community1</span>
<span class="w">          </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">        </span><span class="nt">matchExtCommunitySet</span><span class="p">:</span>
<span class="w">          </span><span class="nt">communitySet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ecommunity1</span>
<span class="w">          </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">        </span><span class="nt">matchAsPathSet</span><span class="p">:</span>
<span class="w">          </span><span class="nt">asPathSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aspath1</span>
<span class="w">          </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">        </span><span class="nt">asPathLength</span><span class="p">:</span>
<span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eq</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">        </span><span class="nt">afiSafiIn</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l3vpn-ipv4-unicast</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4-unicast</span>
<span class="w">    </span><span class="nt">actions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">routeDisposition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accept-route</span>
<span class="w">      </span><span class="nt">bgpActions</span><span class="p">:</span>
<span class="w">        </span><span class="nt">setMed</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-200&quot;</span>
<span class="w">        </span><span class="nt">setAsPathPrepend</span><span class="p">:</span>
<span class="w">          </span><span class="nt">as</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;65005&quot;</span>
<span class="w">          </span><span class="nt">repeatN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">        </span><span class="nt">setCommunity</span><span class="p">:</span>
<span class="w">          </span><span class="nt">options</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">add</span>
<span class="w">          </span><span class="nt">setCommunityMethod</span><span class="p">:</span>
<span class="w">            </span><span class="nt">communitiesList</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65100:20</span><span class="w">  </span>
</code></pre></div>
<p>The elements of policy-definitions are as follows:</p>
<ul>
<li>
<p>policy-definitions</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>policy's name</td>
<td>"example-policy"</td>
</tr>
<tr>
<td>- statements</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>statements's name</td>
<td>"statement1"</td>
</tr>
<tr>
<td>- conditions - match-prefix-set</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>prefixSet</td>
<td>name for defined-sets.prefix-sets.prefix-set-list that is used in this policy</td>
<td>"ps1"</td>
</tr>
<tr>
<td>matchSetOptions</td>
<td>option for the check:<br> "any" or "invert". default is "any"</td>
<td>"any"</td>
</tr>
<tr>
<td>- conditions - match-neighbor-set</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>neighborSet</td>
<td>name for defined-sets.neighbor-sets.neighbor-set-list that is used in this policy</td>
<td>"ns1"</td>
</tr>
<tr>
<td>matchSetOptions</td>
<td>option for the check:<br> "any" or "invert". default is "any"</td>
<td>"any"</td>
</tr>
<tr>
<td>- conditions - bgp-conditions - match-community-set</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>communitySet</td>
<td>name for defined-sets.bgp-defined-sets.community-sets.CommunitySetList that is used in this policy</td>
<td>"community1"</td>
</tr>
<tr>
<td>matchSetOptions</td>
<td>option for the check:<br> "any" or "all" or "invert". default is "any"</td>
<td>"invert"</td>
</tr>
<tr>
<td>- conditions - bgp-conditions - match-ext-community-set</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>communitySet</td>
<td>name for defined-sets.bgp-defined-sets.ext-community-sets that is used in this policy</td>
<td>"ecommunity1"</td>
</tr>
<tr>
<td>matchSetOptions</td>
<td>option for the check:<br> "any" or "all" or "invert". default is "any"</td>
<td>"invert"</td>
</tr>
<tr>
<td>- conditions - bgp-conditions - match-as-path-set</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>asPathSet</td>
<td>name for defined-sets.bgp-defined-sets.as-path-sets that is used in this policy</td>
<td>"aspath1"</td>
</tr>
<tr>
<td>matchSetOptions</td>
<td>option for the check:<br> "any" or "all" or "invert". default is "any"</td>
<td>"invert"</td>
</tr>
<tr>
<td>- conditions - bgp-conditions - match-as-path-length</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>operator</td>
<td>operator to compare the length of AS number in AS_PATH attribute. <br> "eq","ge","le" can be used. <br> "eq" means that length of AS number is equal to Value element <br> "ge" means that length of AS number is equal or greater than the Value element <br> "le" means that length of AS number is equal or smaller than the Value element</td>
<td>"eq"</td>
</tr>
<tr>
<td>value</td>
<td>value used to compare with the length of AS number in AS_PATH attribute</td>
<td>2</td>
</tr>
<tr>
<td>- statements - actions</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>routeDisposition</td>
<td>stop following policy/statement evaluation and accept/reject the route:<br> "accept-route" or "reject-route"</td>
<td>"accept-route"</td>
</tr>
<tr>
<td>- statements - actions - bgp-actions</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>setMed</td>
<td>set-med used to change the med value of the route. <br> If only numbers have been specified, replace the med value of route.<br> if number and operater(+ or -) have been specified, adding or subtracting the med value of route.</td>
<td>"-200"</td>
</tr>
<tr>
<td>- statements - actions - bgp-actions - set-community</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>options</td>
<td>operator to manipulate Community attribute in the route</td>
<td>"ADD"</td>
</tr>
<tr>
<td>communities</td>
<td>communities used to manipulate the route's community according to options below</td>
<td>"65100:20"</td>
</tr>
<tr>
<td>- statements - actions - bgp-actions - set-as-path-prepend</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>as</td>
<td>AS number to prepend. You can use "last-as" to prepend the leftmost AS number in the aspath attribute.</td>
<td>"65100"</td>
</tr>
<tr>
<td>repeatN</td>
<td>repeat count to prepend AS</td>
<td>5</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h4 id="execution-condition-of-action">Execution condition of Action</h4>
<p>Action statement is executed when the result of each Condition, including
 match-set-options is all true.
 <strong>match-set-options</strong> is defined how to determine the match result, in the
 condition with multiple evaluation set as follows:</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>any</td>
<td>match is true if given value matches any member of the defined set</td>
</tr>
<tr>
<td>all</td>
<td>match is true if given value matches all members of the defined set</td>
</tr>
<tr>
<td>invert</td>
<td>match is true if given value does not match any member of the defined set</td>
</tr>
</tbody>
</table>
<h5 id="examples_5">Examples</h5>
<ul>
<li>example 1</li>
<li>This policy definition has prefix-set <em>ps1</em> and neighbor-set <em>ns1</em> as its
    condition and routes matches the condition is rejected.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 1</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinition.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinitionService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy1</span>
<span class="w">  </span><span class="nt">statements</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statement1</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matchPrefixSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prefixSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ps1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">      </span><span class="nt">matchNeighborSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">neighborSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ns1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">    </span><span class="nt">actions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">routeDisposition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reject-route</span>
</code></pre></div>
<ul>
<li>example 2</li>
<li>policy-definition has two statements</li>
<li>If a route matches the condition inside the first statement(1), GoBGP
    applies its action and quits the policy evaluation.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 2</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinition.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinitionService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy1</span>
<span class="w">  </span><span class="nt">statements</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statement1</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matchPrefixSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prefixSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ps1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">      </span><span class="nt">matchNeighborSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">neighborSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ns1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">    </span><span class="nt">actions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">routeDisposition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reject-route</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statement2</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matchPrefixSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prefixSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ps2</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">      </span><span class="nt">matchNeighborSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">neighborSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ns2</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">    </span><span class="nt">actions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">routeDisposition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reject-route</span>
</code></pre></div>
<ul>
<li>example 3</li>
<li>If you want to add other policies, just add policy-definitions block
    following the first one like this</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinition.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinitionService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy1</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy1</span>
<span class="w">  </span><span class="nt">statements</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statement1</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matchPrefixSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prefixSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ps1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">      </span><span class="nt">matchNeighborSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">neighborSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ns1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">    </span><span class="nt">actions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">routeDisposition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reject-route</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinition.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinitionService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy2</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statement2</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matchPrefixSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prefixSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ps2</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">      </span><span class="nt">matchNeighborSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">neighborSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ns2</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">    </span><span class="nt">actions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">routeDisposition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reject-route</span>
</code></pre></div>
<ul>
<li>example 4</li>
<li>This PolicyDefinition has multiple conditions including BgpConditions as
    follows:<ul>
<li>prefix-set: <em>ps1</em></li>
<li>neighbor-set: <em>ns1</em></li>
<li>community-set: <em>community1</em></li>
<li>ext-community-set: <em>ecommunity1</em></li>
<li>as-path-set: <em>aspath1</em></li>
<li>as-path length: <em>equal 2</em></li>
</ul>
</li>
<li>If a route matches all these conditions, it will be accepted with community
    "65100:20", next-hop 10.0.0.1, local-pref 110, med subtracted 200, as-path
    prepended 65005 five times.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># example 4</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicydefinition.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyDefinitionService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-policy</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-policy</span>
<span class="w">  </span><span class="nt">statements</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statement1</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matchPrefixSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prefixSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ps1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">      </span><span class="nt">matchNeighborSet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">neighborSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ns1</span>
<span class="w">        </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">invert</span>
<span class="w">      </span><span class="nt">bgpConditions</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchCommunitySet</span><span class="p">:</span>
<span class="w">          </span><span class="nt">communitySet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">community1</span>
<span class="w">          </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">        </span><span class="nt">matchExtCommunitySet</span><span class="p">:</span>
<span class="w">          </span><span class="nt">communitySet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ecommunity1</span>
<span class="w">          </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">        </span><span class="nt">matchAsPathSet</span><span class="p">:</span>
<span class="w">          </span><span class="nt">asPathSet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aspath1</span>
<span class="w">          </span><span class="nt">matchSetOptions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">        </span><span class="nt">asPathLength</span><span class="p">:</span>
<span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eq</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">        </span><span class="nt">afiSafiIn</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l3vpn-ipv4-unicast</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4-unicast</span>
<span class="w">    </span><span class="nt">actions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">routeDisposition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accept-route</span>
<span class="w">      </span><span class="nt">bgpActions</span><span class="p">:</span>
<span class="w">        </span><span class="nt">setMed</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-200&quot;</span>
<span class="w">        </span><span class="nt">setAsPathPrepend</span><span class="p">:</span>
<span class="w">          </span><span class="nt">as</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;65005&quot;</span>
<span class="w">          </span><span class="nt">repeatN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">        </span><span class="nt">setCommunity</span><span class="p">:</span>
<span class="w">          </span><span class="nt">options</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">add</span>
<span class="w">          </span><span class="nt">setCommunityMethod</span><span class="p">:</span>
<span class="w">            </span><span class="nt">communitiesList</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65100:20</span><span class="w">  </span>
</code></pre></div>
<h3 id="4-attaching-policy">4. Attaching policy</h3>
<p>Here we explain how to attach defined policies to
<a href="#42-attach-policy-to-route-server-client">neighbor local rib</a>.</p>
<h4 id="41-attach-policy-to-route-server-client">4.1. Attach policy to route-server-client</h4>
<p>You can use policies defined above as Import or Export or In policy by
attaching them to neighbors which is configured to be route-server client.</p>
<p>To attach policies to neighbors, you need to add policy's name to
<code>neighbors.apply-policy</code> in the neighbor's setting.
This example attaches <em>policy1</em> to Import policy and <em>policy2</em> to Export policy
and <em>policy3</em> is used as the In policy.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bgppolicyapply.loxilb.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BGPPolicyApplyService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-apply</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ipAddress</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.0.255.2&quot;</span>
<span class="w">  </span><span class="nt">policyType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;import&quot;</span>
<span class="w">  </span><span class="nt">polices</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;policy1&quot;</span>
<span class="w">  </span><span class="nt">routeAction</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;accept&quot;</span>
</code></pre></div>
<p>neighbors has a section to specify policies and the section's name is
apply-policy. The apply-policy has 4 elements.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>ipAddress</td>
<td>neighbor IP address</td>
<td>"10.0.255.2"</td>
</tr>
<tr>
<td>policyType</td>
<td>option for the Policy type:<br> "import" or "export" .</td>
<td>"import"</td>
</tr>
<tr>
<td>polices</td>
<td>The list of the policy</td>
<td>- "policy1"</td>
</tr>
<tr>
<td>routeAction</td>
<td>action when the route doesn't match any policy or none of the matched policy specifies route-disposition:<br> "accept" or "reject".</td>
<td>"accept"</td>
</tr>
</tbody>
</table>
<h2 id="policy-and-soft-reset">Policy and Soft Reset</h2>
<p>When you change an import policy and reset the inbound routing table (aka soft reset in), a withdraw for a route rejected by the latest import policies will be sent to peers. However, when you change an export policy and reset the outbound routing table (aka soft reset out), even if a route is rejected by the latest export policies, a withdraw for the route will not be sent.</p>
<p>The outbound routing table doesn't exist for saving memory usage, it's impossible to know whether the route was actually sent to peer or the route also was rejected by the previous export policies and not sent. GoBGP doesn't send such withdraw rather than possible unwilling leaking information.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.path", "navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.top", "search.suggest"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": "v0.9.5 (Latest)"}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>