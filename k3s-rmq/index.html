<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://loxilb-io.github.io/loxilbdocs/k3s-rmq/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>K3s rmq - loxilb v0.9.1</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../stylesheets/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-21G7NBL2BN"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-21G7NBL2BN");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">loxilb v0.9.1</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">How-To Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../kube-loxilb/" class="dropdown-item">How-To - kube-loxilb</a>
</li>
                                    
<li>
    <a href="../service-zones/" class="dropdown-item">How-To - service-group zones</a>
</li>
                                    
<li>
    <a href="../run/" class="dropdown-item">How-To - build/run</a>
</li>
                                    
<li>
    <a href="../cmd/" class="dropdown-item">How-To - configuration</a>
</li>
                                    
<li>
    <a href="../debugging/" class="dropdown-item">How-To - debug</a>
</li>
                                    
<li>
    <a href="../integrate_bgp_eng/" class="dropdown-item">How-To - loxilb with calico bgp</a>
</li>
                                    
<li>
    <a href="../standalone/" class="dropdown-item">How-To - loxilb in standalone mode</a>
</li>
                                    
<li>
    <a href="../api/" class="dropdown-item">How-To - loxilb Web-APIs</a>
</li>
                                    
<li>
    <a href="../ha-deploy/" class="dropdown-item">How-To - high-availability with loxilb</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Knowledge Base <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../ebpf/" class="dropdown-item">What is eBPF</a>
</li>
                                    
<li>
    <a href="../lb/" class="dropdown-item">What is k8s service - load-balancer</a>
</li>
                                    
<li>
    <a href="../arch/" class="dropdown-item">Architecture in brief</a>
</li>
                                    
<li>
    <a href="../code/" class="dropdown-item">Code organization</a>
</li>
                                    
<li>
    <a href="../loxilbebpf/" class="dropdown-item">eBPF internals</a>
</li>
                                    
<li>
    <a href="../nat/" class="dropdown-item">NAT Modes of loxilb</a>
</li>
                                    
<li>
    <a href="../lb-algo/" class="dropdown-item">loxilb load-balancer algorithms</a>
</li>
                                    
<li>
    <a href="../cmd-dev/" class="dropdown-item">Developer's guide to loxicmd</a>
</li>
                                    
<li>
    <a href="../api-dev/" class="dropdown-item">Developer's guide to loxilb API</a>
</li>
                                    
<li>
    <a href="../perf/" class="dropdown-item">Performance Report</a>
</li>
                                    
<li>
    <a href="../roadmap/" class="dropdown-item">Development Roadmap</a>
</li>
                                    
<li>
    <a href="../contribute/" class="dropdown-item">Contribution Guide</a>
</li>
                                    
<li>
    <a href="../requirements/" class="dropdown-item">System Requirements</a>
</li>
                                    
<li>
    <a href="../faq/" class="dropdown-item">Frequenctly Asked Questions- FAQs</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Blogs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="https://www.loxilb.io/post/loxilb-cluster-networking-elevating-k8s-networking-capabilities" class="dropdown-item">K8s - Elevating Cluster Networking</a>
</li>
                                    
<li>
    <a href="https://www.loxilb.io/post/state-synchronization-of-ebpf-maps-using-go-a-tale-of-two-frameworks" class="dropdown-item">eBPF - Map Sync using Go</a>
</li>
                                    
<li>
    <a href="https://www.loxilb.io/post/k8s-nuances-of-in-cluster-external-service-lb-with-loxilb" class="dropdown-item">K8s in-cluster service LB with LoxiLB</a>
</li>
                                    
<li>
    <a href="https://www.loxilb.io/post/k8s-introducing-sctp-multihoming-functionality-with-loxilb" class="dropdown-item">K8s - Introducing SCTP Multihoming with LoxiLB</a>
</li>
                                    
<li>
    <a href="https://www.loxilb.io/post/loxilb-anycast-service-load-balancing-with-high-availability" class="dropdown-item">Hyperscale anycast load balancing with HA</a>
</li>
                                    
<li>
    <a href="https://www.loxilb.io/post/loxilb-load-balancer-setup-on-eks" class="dropdown-item">Getting started with loxilb on Amazon EKS</a>
</li>
                                    
<li>
    <a href="https://www.loxilb.io/post/k8s-deploying-hitless-and-ha-load-balancing" class="dropdown-item">K8s - Deploying hitless Load-Balancing</a>
</li>
                                    
<li>
    <a href="https://www.loxilb.io/post/k8s-exposing-ipv4-services-externally-as-ipv6" class="dropdown-item">Ipv6 migration in Kubernetes made easy</a>
</li>
                                    
<li>
    <a href="https://www.loxilb.io/post/running-loxilb-on-aws-graviton2-based-ec2-instance" class="dropdown-item">Load-balancer Perf comparison on Amazon Graviton2</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Community Posts</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="https://futuredon.medium.com/5g-sctp-loadbalancer-using-loxilb-b525198a9103" class="dropdown-item">5G SCTP LoadBalancer Using loxilb</a>
</li>
            
<li>
    <a href="https://futuredon.medium.com/5g-uplink-classifier-using-loxilb-7593a4d66f4c" class="dropdown-item">5G Uplink Classifier Using loxilb</a>
</li>
            
<li>
    <a href="https://cloudybytes.medium.com/k3s-using-loxilb-as-external-service-lb-2ea4ce61e159" class="dropdown-item">K3s - Using loxilb as external service lb</a>
</li>
            
<li>
    <a href="https://medium.com/@ben0978327139/5g-sctp-loadbalancer-using-loxilb-applying-on-free5gc-b5c05bb723f0" class="dropdown-item">5G SCTP LoadBalancer Using LoxiLB Applying on free5GC</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#quick-start-guide-with-k3s-and-loxilb-in-cluster-service-proxy-mode" class="nav-link">Quick Start Guide with K3s and LoxiLB in-cluster "service-proxy" mode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#setup-k3s" class="nav-link">Setup K3s</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#how-to-deploy-kube-loxilb" class="nav-link">How to deploy kube-loxilb ?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#how-to-deploy-loxilb" class="nav-link">How to deploy loxilb ?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#seup-rabbitmq-operator" class="nav-link">Seup RabbitMQ Operator</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#setup-rabbitmq-application-with-loxilb" class="nav-link">Setup RabbitMQ application with loxilb</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#check-the-status" class="nav-link">Check the status</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="quick-start-guide-with-k3s-and-loxilb-in-cluster-service-proxy-mode">Quick Start Guide with K3s and LoxiLB in-cluster "service-proxy" mode</h2>
<p>This document will explain how to install a K3s cluster with loxilb as a serviceLB provider running in-cluster "service-proxy" mode.     </p>
<h3 id="what-is-service-proxy-mode">What is service-proxy mode?</h3>
<p><b>service-proxy</b> mode is where kubernetes cluster networking is entirely streamlined by loxilb for better performance.</p>
<p><img alt="service-proxy" src="../photos/service-proxy.svg" />
Looking at the left side of the image, you will notice the traffic flow of the packet as it enters the Kubernetes cluster. Kube-proxy, the de-facto networking agent in the Kubernetes which runs on each node of the cluster which monitors the services and translates them to either iptables or IPVS tangible rules. If we talk about the functionality or a cluster with low volume traffic then kube-proxy is fine but when it comes to scalability or a high volume traffic then it acts as a bottle-neck.
loxilb <b><i>"service-proxy"</i></b> mode works with Flannel and kube-proxy in IPVS mode. It simplifies all the IPVS rules and injects them in it's in-kernel eBPF data-path. Traffic will reach at the interface, will be processed by eBPF and sent directly to the pod or to the other node, bypassing all the layers of Linux networking. This way, all the services, be it External, NodePort or ClusterIP, can be managed through LoxiLB.</p>
<h3 id="topology">Topology</h3>
<p>For quickly bringing up loxilb in-cluster and K3s, we will be deploying a 4 nodes k3s cluster :   </p>
<p><img alt="loxilb topology" src="../photos/service-proxy-topo.png" /></p>
<p>loxilb and kube-loxilb components run as pods managed by kubernetes  in this scenario.</p>
<h2 id="setup-k3s">Setup K3s</h2>
<h3 id="configure-master-node">Configure Master node</h3>
<pre><code>$ curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC=&quot;--disable traefik \
--disable servicelb \
--disable-cloud-controller \
--kube-proxy-arg proxy-mode=ipvs \
--flannel-iface=eth1 \
--disable-network-policy \
--node-ip=${MASTER_IP} \
--node-external-ip=${MASTER_IP} \
--bind-address=${MASTER_IP}&quot; sh -
</code></pre>
<h3 id="configure-worker-nodes">Configure Worker nodes</h3>
<pre><code>$ curl -sfL https://get.k3s.io | K3S_URL=&quot;https://${MASTER_IP}:6443&quot;\
 K3S_TOKEN=&quot;${NODE_TOKEN}&quot; \
 INSTALL_K3S_EXEC=&quot;--node-ip=${WORKER_ADDR} \
--node-external-ip=${WORKER_IP} \
--kube-proxy-arg proxy-mode=ipvs \
--flannel-iface=eth1&quot; sh -
</code></pre>
<h2 id="how-to-deploy-kube-loxilb">How to deploy kube-loxilb ?</h2>
<p><a href="https://github.com/loxilb-io/kube-loxilb">kube-loxilb</a> is used as an operator to manage loxilb.</p>
<pre><code>wget https://raw.githubusercontent.com/loxilb-io/kube-loxilb/main/manifest/mesh/kube-loxilb.yml
</code></pre>
<p>kube-loxilb.yaml</p>
<pre><code>       args:
         #- --loxiURL=http://172.17.0.2:11111
         - --externalCIDR=192.168.82.100/32
         - --setRoles=0.0.0.0
         #- --monitor
         #- --setBGP

</code></pre>
<p>In the above snippet, loxiURL is commented out which denotes to utilize in-cluster mode to discover loxilb pods automatically. External CIDR represents the IP pool from where serviceLB VIP will be allocated.</p>
<p>Apply after making changes (if any) :</p>
<pre><code>sudo kubectl apply -f kube-loxilb.yaml
</code></pre>
<h2 id="how-to-deploy-loxilb">How to deploy loxilb ?</h2>
<p>loxilb can be deloyed by using the following command in the K3s node</p>
<pre><code>sudo kubectl apply -f https://raw.githubusercontent.com/loxilb-io/kube-loxilb/main/manifest/mesh/loxilb-mesh.yml
</code></pre>
<h2 id="seup-rabbitmq-operator">Seup RabbitMQ Operator</h2>
<pre><code>sudo kubectl apply -f &quot;https://github.com/rabbitmq/cluster-operator/releases/latest/download/cluster-operator.yml&quot;
</code></pre>
<h2 id="setup-rabbitmq-application-with-loxilb">Setup RabbitMQ application with loxilb</h2>
<pre><code>wget https://raw.githubusercontent.com/rabbitmq/cluster-operator/main/docs/examples/hello-world/rabbitmq.yaml
</code></pre>
<p>Change the following:</p>
<pre><code>apiVersion: rabbitmq.com/v1beta1
kind: RabbitmqCluster
metadata:
  name: hello-world
spec:
  replicas: 3
  service:
    type: LoadBalancer
  override:
    service:
      spec:
        loadBalancerClass: loxilb.io/loxilb
        externalTrafficPolicy: Local
        ports:
        - port: 5672
</code></pre>
<h3 id="create-the-service">Create the service</h3>
<pre><code>sudo kubectl apply -f rabbitmq.yaml
</code></pre>
<h2 id="check-the-status">Check the status</h2>
<p>In k3s node:</p>
<pre><code>## Check the pods created
$ sudo kubectl get pods -A
NAMESPACE         NAME                                        READY   STATUS    RESTARTS   AGE
kube-system       local-path-provisioner-6c86858495-65tbc     1/1     Running   0          137m
kube-system       coredns-6799fbcd5-5h2dw                     1/1     Running   0          137m
kube-system       metrics-server-67c658944b-mtv9q             1/1     Running   0          137m
rabbitmq-system   rabbitmq-cluster-operator-ccf488f4c-sphfm   1/1     Running   0          8m12s
kube-system       kube-loxilb-5fb5566999-4dj2v                1/1     Running   0          4m18s
kube-system       loxilb-lb-txtfm                             1/1     Running   0          3m57s
kube-system       loxilb-lb-fnv97                             1/1     Running   0          3m57s
kube-system       loxilb-lb-r7mks                             1/1     Running   0          3m57s
kube-system       loxilb-lb-xxn29                             1/1     Running   0          3m57s
default           hello-world-server-0                        1/1     Running   0          72s
default           hello-world-server-1                        1/1     Running   0          72s
default           hello-world-server-2                        1/1     Running   0          72s


## Check the services created
$ sudo kubectl get svc
sudo kubectl get svc
NAME                TYPE           CLUSTER-IP      EXTERNAL-IP         PORT(S)                                           AGE
kubernetes          ClusterIP      10.43.0.1       &lt;none&gt;              443/TCP                                           136m
hello-world-nodes   ClusterIP      None            &lt;none&gt;              4369/TCP,25672/TCP                                7s
hello-world         LoadBalancer   10.43.190.199   llb-192.168.82.100   15692:31224/TCP,5672:30817/TCP,15672:30698/TCP   7s
</code></pre>
<p>In loxilb pod, we can check internal LB rules:</p>
<pre><code>$ sudo kubectl exec -it -n kube-system loxilb-lb-8l85d -- loxicmd get lb -o wide
sudo kubectl exec -it loxilb-lb-txtfm -n kube-system -- loxicmd get lb -o wide
|    EXT IP     | SEC IPS | PORT  | PROTO |             NAME             | MARK | SEL |  MODE   |    ENDPOINT    | EPORT | WEIGHT | STATE  | COUNTERS |
|---------------|---------|-------|-------|------------------------------|------|-----|---------|----------------|-------|--------|--------|----------|
| 10.0.2.15     |         | 30698 | tcp   | ipvs_10.0.2.15:30698-tcp     |    0 | rr  | fullnat | 10.42.1.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15672 |      1 | active | 0:0      |
| 10.0.2.15     |         | 30817 | tcp   | ipvs_10.0.2.15:30817-tcp     |    0 | rr  | fullnat | 10.42.1.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      |  5672 |      1 | active | 0:0      |
| 10.0.2.15     |         | 31224 | tcp   | ipvs_10.0.2.15:31224-tcp     |    0 | rr  | fullnat | 10.42.1.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15692 |      1 | active | 0:0      |
| 10.42.0.0     |         | 30698 | tcp   | ipvs_10.42.0.0:30698-tcp     |    0 | rr  | fullnat | 10.42.1.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15672 |      1 | active | 0:0      |
| 10.42.0.0     |         | 30817 | tcp   | ipvs_10.42.0.0:30817-tcp     |    0 | rr  | fullnat | 10.42.1.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      |  5672 |      1 | active | 0:0      |
| 10.42.0.0     |         | 31224 | tcp   | ipvs_10.42.0.0:31224-tcp     |    0 | rr  | fullnat | 10.42.1.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15692 |      1 | active | 0:0      |
| 10.42.0.1     |         | 30698 | tcp   | ipvs_10.42.0.1:30698-tcp     |    0 | rr  | fullnat | 10.42.1.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15672 |      1 | active | 0:0      |
| 10.42.0.1     |         | 30817 | tcp   | ipvs_10.42.0.1:30817-tcp     |    0 | rr  | fullnat | 10.42.1.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      |  5672 |      1 | active | 0:0      |
| 10.42.0.1     |         | 31224 | tcp   | ipvs_10.42.0.1:31224-tcp     |    0 | rr  | fullnat | 10.42.1.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15692 |      1 | active | 0:0      |
| 10.43.0.10    |         |    53 | tcp   | ipvs_10.43.0.10:53-tcp       |    0 | rr  | default | 10.42.0.3      |    53 |      1 | -      | 0:0      |
| 10.43.0.10    |         |    53 | udp   | ipvs_10.43.0.10:53-udp       |    0 | rr  | default | 10.42.0.3      |    53 |      1 | -      | 0:0      |
| 10.43.0.10    |         |  9153 | tcp   | ipvs_10.43.0.10:9153-tcp     |    0 | rr  | default | 10.42.0.3      |  9153 |      1 | -      | 0:0      |
| 10.43.0.1     |         |   443 | tcp   | ipvs_10.43.0.1:443-tcp       |    0 | rr  | default | 192.168.80.10  |  6443 |      1 | -      | 0:0      |
| 10.43.190.199 |         |  5672 | tcp   | ipvs_10.43.190.199:5672-tcp  |    0 | rr  | default | 10.42.1.6      |  5672 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      |  5672 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      |  5672 |      1 | -      | 0:0      |
| 10.43.190.199 |         | 15672 | tcp   | ipvs_10.43.190.199:15672-tcp |    0 | rr  | default | 10.42.1.6      | 15672 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15672 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15672 |      1 | -      | 0:0      |
| 10.43.190.199 |         | 15692 | tcp   | ipvs_10.43.190.199:15692-tcp |    0 | rr  | default | 10.42.1.6      | 15692 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15692 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15692 |      1 | -      | 0:0      |
| 10.43.5.58    |         |   443 | tcp   | ipvs_10.43.5.58:443-tcp      |    0 | rr  | default | 10.42.0.4      | 10250 |      1 | -      | 0:0      |
| 192.168.80.10 |         | 30698 | tcp   | ipvs_192.168.80.10:30698-tcp |    0 | rr  | fullnat | 10.42.1.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15672 |      1 | active | 0:0      |
| 192.168.80.10 |         | 30817 | tcp   | ipvs_192.168.80.10:30817-tcp |    0 | rr  | fullnat | 10.42.1.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      |  5672 |      1 | active | 0:0      |
| 192.168.80.10 |         | 31224 | tcp   | ipvs_192.168.80.10:31224-tcp |    0 | rr  | fullnat | 10.42.1.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15692 |      1 | active | 0:0      |
| 192.168.80.20 |         |  5672 | tcp   | default_hello-world          |    0 | rr  | onearm  | 192.168.80.101 | 30817 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 192.168.80.102 | 30817 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 192.168.80.103 | 30817 |      1 | -      | 0:0      |
| 192.168.80.20 |         | 15672 | tcp   | default_hello-world          |    0 | rr  | onearm  | 192.168.80.101 | 30698 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 192.168.80.102 | 30698 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 192.168.80.103 | 30698 |      1 | -      | 0:0      |
| 192.168.80.20 |         | 15692 | tcp   | default_hello-world          |    0 | rr  | onearm  | 192.168.80.101 | 31224 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 192.168.80.102 | 31224 |      1 | -      | 0:0      |
|               |         |       |       |                              |      |     |         | 192.168.80.103 | 31224 |      1 | -      | 0:0      |
| 192.168.80.20 |         | 30698 | tcp   | ipvs_192.168.80.20:30698-tcp |    0 | rr  | fullnat | 10.42.1.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15672 |      1 | active | 0:0      |
| 192.168.80.20 |         | 30817 | tcp   | ipvs_192.168.80.20:30817-tcp |    0 | rr  | fullnat | 10.42.1.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      |  5672 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      |  5672 |      1 | active | 0:0      |
| 192.168.80.20 |         | 31224 | tcp   | ipvs_192.168.80.20:31224-tcp |    0 | rr  | fullnat | 10.42.1.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.2.6      | 15692 |      1 | active | 0:0      |
|               |         |       |       |                              |      |     |         | 10.42.3.7      | 15692 |      1 | active | 0:0      |

</code></pre>
<h3 id="get-rabbitmq-credentials">Get RabbitMQ Credentials</h3>
<pre><code>username=&quot;$(sudo kubectl get secret hello-world-default-user -o jsonpath='{.data.username}' | base64 --decode)&quot;
password=&quot;$(sudo kubectl get secret hello-world-default-user -o jsonpath='{.data.password}' | base64 --decode)&quot;
</code></pre>
<h3 id="test-rabbitmq-from-hostclient">Test RabbitMQ from host/client</h3>
<pre><code>sudo docker run -it --rm --net=host pivotalrabbitmq/perf-test:latest --uri amqp://$username:$password@192.168.80.20:5672 -x 10  -y 10 -u &quot;throughput-test-4&quot; -a --id &quot;test 4&quot;  -z100
</code></pre>
<p>For more detailed performance comparison with other solutions, kindly follow this <a href="https://www.loxilb.io/post/loxilb-cluster-networking-elevating-k8s-networking-capabilities">blog</a> and for more detailed information
on incluster deployment of loxilb with bgp in a full-blown cluster, kindly follow this <a href="https://www.loxilb.io/post/k8s-nuances-of-in-cluster-external-service-lb-with-loxilb">blog</a>.   </p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
