<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="https://loxilb-io.github.io/loxilbdocs/perf/" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>Performance - LoxiLB Documentations</title>
<link href="../css/theme.css" rel="stylesheet"/>
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" rel="stylesheet"/>
<script>
        // Current page data
        var mkdocs_page_name = "Performance";
        var mkdocs_page_input_path = "perf.md";
        var mkdocs_page_url = "/loxilbdocs/perf/";
      </script>
<script defer="" src="../js/jquery-3.6.0.min.js"></script>
<!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-21G7NBL2BN"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-21G7NBL2BN');
      </script>
</head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> LoxiLB Documentations
        </a>
<div class="version">
          0.9.2 (Latest)
        </div>
</div>
<div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="..">Home</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ebpf/">What is eBPF</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lb/">What is service type - external load-balancer</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/">Architecture in brief</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code/">Code organization</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../loxilbebpf/">eBPF internals of loxilb</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../run/">Howto - build/run</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ccm/">Howto - ccm plugin</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../debugging/">Howto - debug</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../integrate_bgp_eng/">Howto - loxib with calico bgp</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cmd/">Cmd/Config guide</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/">Api usage/dev guide</a>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal current" href="./">Performance</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#single-node-performance-simple">Single node performance (simple)</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multi-node-performance-real-topology">Multi node performance (real topology)</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#comparision-with-lvs">Comparision with LVS</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/">Development Roadmap</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribute/">Contribute</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/">FAQs</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">LoxiLB Documentations</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a alt="Docs" class="icon icon-home" href=".."></a> »</li>
<li>Performance</li>
<li class="wy-breadcrumbs-aside">
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div class="section" itemprop="articleBody">
<h1 id="loxilb-performance">loxilb Performance</h1>
<h2 id="single-node-performance-simple">Single node performance (simple)</h2>
<p>loxilb is running as a docker inside a VM. The VM is assigned the following resources :  </p>
<p><em>Intel(R) Core(TM) i7-4770HQ CPU @ 2.20GHz - 2 core RAM 4GB</em></p>
<p>All the other hosts are simulated with docker pods inside the same VM. The following command can be used to configure lb for the given topology:</p>
<pre><code># loxicmd create lb 20.20.20.1 --tcp=2020:5001 --endpoints=31.31.31.1:1,32.32.32.1:1,17.17.17.1:1
</code></pre>
<div class="mermaid">graph LR;
    A[100.100.100.1]--&gt;B[loxilb];
    B--&gt;C[31.31.31.1];
    B--&gt;D[32.32.32.1];
    B--&gt;E[17.17.17.1];
</div>
<p>To create the above topology for testing loxilb, users can follow this <a href="../simple_topo/">guide</a>. A go webserver with an empty response is used for benchmark purposes. The code is as following :</p>
<pre><code>package main

import (
        "log"
        "net/http"
)

func main() {
        http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {

        })
        if err := http.ListenAndServe(":5001", nil); err != nil {
                log.Fatal("ListenAndServe: ", err)
        }
}
</code></pre>
<p>The above code runs in each of the load-balancer end-points.</p>
<p>We use <a href="https://github.com/wg/wrk">wrk</a> HTTP benchmarking tool for this test. This is run inside the client "100.100.100.1" host. </p>
<pre><code>root@loxilb:/home/loxilb # wrk -t8 -c400 -d30s http://20.20.20.1:2020/
Running 30s test @ http://20.20.20.1:2020/
  8 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     8.56ms   11.24ms 137.41ms   86.54%
    Req/Sec     5.05k     1.04k   10.30k    71.89%
  1204823 requests in 30.08s, 86.18MB read
Requests/sec:  40057.34
Transfer/sec:  2.87MB

</code></pre>
<p>As a baseline, we compare the numbers with loopback test i.e running <em>wrk</em> in the same host as the webserver.</p>
<pre><code>root@loxilb:/home/loxilb # wrk -t8 -c400 -d30s http://127.0.0.1:5001/
Running 30s test @ http://127.0.0.1:5001/
  8 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    15.34ms   18.61ms 166.29ms   85.05%
    Req/Sec     5.37k     2.98k   19.82k    70.09%
  1282161 requests in 30.09s, 91.71MB read
Requests/sec:  42612.30
Transfer/sec:  3.05MB
</code></pre>
<p>Based on the above tests, loxilb performs at 95% of the baseline numbers in requests/sec and latency actually improves by ~50% with loxilb.</p>
<h2 id="multi-node-performance-real-topology">Multi node performance (real topology)</h2>
<p>The topology for this test is similar to the above case. However, all the services run in one system and loxilb run in separate dedicated system. All other configurations remain the same.</p>
<div class="mermaid">
sequenceDiagram
    participant ServiceA1
    participant ServiceA2
    participant ServiceA3
    participant loxilb
    participant ServiceB_PodX
    participant ServiceB_PodY
    participant ServiceB_PodZ
    ServiceA1-&gt;&gt;loxilb: 100.100.100.1-&gt;20.20.20.1
    ServiceA2-&gt;&gt;loxilb: 101.101.101.1-&gt;20.20.20.1
    ServiceA3-&gt;&gt;loxilb: 102.102.102.1-&gt;20.20.20.1
    Note right of loxilb: Distribute the traffic in Round Robin fashion(default)!
    loxilb--&gt;&gt;ServiceB_PodX: 100.100.100.1-&gt;31.31.31.1
    loxilb--&gt;&gt;ServiceB_PodY: 101.101.101.1-&gt;32.32.32.1
    loxilb--&gt;&gt;ServiceB_PodZ: 102.102.102.1-&gt;17.17.17.1

</div>
<p>loxilb server specs is as follows :<br/>
<em>Intel(R) Xeon(R) Silver 4210R CPU @ 2.40GHz - 40 core RAM 125GB</em></p>
<p>We use wrk HTTP benchmarking tool for this test as well. This is run inside the client "100.100.100.1" host.</p>
<pre><code>root@loxilb:/home/loxilb # wrk -t8 -c400 -d30s http://20.20.20.1:2020/
Running 30s test @ http://20.20.20.1:2020/
  8 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.44ms   10.58ms 222.86ms   99.14%
    Req/Sec    39.06k     4.90k   57.34k    64.62%
  9331956 requests in 30.07s, 667.47MB read
Requests/sec: 310364.26
Transfer/sec:     22.20MB
</code></pre>
<h2 id="comparision-with-lvs">Comparision with <a href="https://en.wikipedia.org/wiki/Linux_Virtual_Server">LVS</a></h2>
<p>LVS is based on linux kernel networking and is a popular open-source load-balancer. Comparision with LVS will show us how eBPF can improve on linux kernel networking</p>
<p>ipvsadm configuration(Check <a href="https://dev.to/douglasmakey/how-to-setup-simple-load-balancing-with-ipvs-demo-with-docker-4j1d">here</a> for more details)</p>
<pre><code>root@1167483bd551:/# ip addr add 20.20.20.1/32 dev lo
root@1167483bd551:/# ipvsadm -A -t 20.20.20.1:2020 -s rr
root@1167483bd551:/# ipvsadm -a -t 20.20.20.1:2020 -r 17.17.17.1:5001 -m
root@1167483bd551:/# ipvsadm -a -t 20.20.20.1:2020 -r 31.31.31.1:5001 -m
root@1167483bd551:/# ipvsadm -a -t 20.20.20.1:2020 -r 32.32.32.1:5001 -m
</code></pre>
<p>We use wrk HTTP benchmarking tool for this test as well. This is run inside the client "100.100.100.1" host.</p>
<pre><code>root@loxilb:/home/loxilb # wrk -t8 -c400 -d30s http://20.20.20.1:2020/
Running 30s test @ http://20.20.20.1:2020/
  8 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     3.81ms   17.66ms 222.32ms   98.02%
    Req/Sec    37.35k     3.72k  115.09k    72.18%
  8925647 requests in 30.10s, 638.41MB read
Requests/sec: 296537.63
Transfer/sec:     21.21MB
</code></pre>
<p>ipvsadm statistics</p>
<pre><code>root@1167483bd551:/# ipvsadm -l --stats
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port               Conns   InPkts  OutPkts  InBytes OutBytes
  -&gt; RemoteAddress:Port
TCP  20.20.20.1:2020                   401  8939187  8953980  830843K    1135M
  -&gt; 17.17.17.1:5001                   134  3026088  3031335  281255K  384268K
  -&gt; 1.31.31.31.dyn.idknet.com:50      133  2959491  2964454  275069K  375809K
  -&gt; 32.32.32.1:5001                   134  2953608  2958191  274518K  375034K
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>loxilb's latency is 2.44 ms which is much less as compared to 3.81 ms in case of LVS. Number of Requests handled per second is 39.06K with loxilb, better than 37.35K with LVS.</p>
</div>
</div><footer>
<div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-left" href="../api/" title="Api usage/dev guide"><span class="icon icon-circle-arrow-left"></span> Previous</a>
<a class="btn btn-neutral float-right" href="../roadmap/" title="Development Roadmap">Next <span class="icon icon-circle-arrow-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="Versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span><a href="../api/" style="color: #fcfcfc">« Previous</a></span>
<span><a href="../roadmap/" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme_extra.js"></script>
<script defer="" src="../js/theme.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
<script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script><script>mermaid.initialize({});</script></body>
</html>
